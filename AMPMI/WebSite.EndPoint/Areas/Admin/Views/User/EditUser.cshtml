@model WebSite.EndPoint.Areas.Admin.Models.Company.CompanyVM
@{
    Layout = "~/Areas/Admin/Views/Shared/_layout.cshtml";
    ViewData["SelectedAdmin"] = "User";
}
<style>
    .prevImage {
        width: 100%;
        height: 100%;
    }

    .btn.btn-submit {
        color: white !important; /* همیشه متن سفید باشد */
    }

    .text-danger {
        font-size: 12px !important;
        color: red !important;
    }

    .btn.btn-submit:hover {
        color: white !important; /* در حالت هاور هم سفید بماند */
    }
</style>

<div class="container-fluid">
    <div class="pageName">
        <span class="textPage">
            <a asp-area="Admin" asp-controller=User asp-action=UserList>
                لیست کاربران
            </a>
            > تعریف/ویرایش کاربران
        </span>
    </div>
    @if (ViewData["error"] is not null)
    {
        <div class="row">
            <p style="color:red;">@ViewData["error"]?.ToString()</p>
        </div>
    }
    <div>
        @* <a href="#" id="save"><img class="img-Icon" src="~/images/diskette copy.png" /></a> *@
    </div>
    <div class="mt-2 pageMargin">
        <form enctype="multipart/form-data" id="saveForm" asp-area="Admin" asp-action="Save" asp-controller="User" method="post">
            <div class="row mt-2 userEditRow">
                <div class="col-md-6 my-2">
                    <div class="form-check d-flex align-items-center">
                        <input asp-for="IsCompany" class="form-check-input me-2" type="checkbox" id="CisCompany" />
                        <label for="CisCompany" class="form-check-label mb-0">تغییر نقش به تولید کننده</label>
                    </div>
                </div>
            </div>
            <input asp-for="Id" type="hidden" />
            <input type="hidden" asp-for="LogoRout" />
            <div class="row">
                <div class="col-md-6 my-2">
                    <label for="Cname" class="labelText">نام شرکت</label>
                    <input asp-for="Name" class="labelText input-text" type="text" id="Cname" />
                    <span class="text-danger" asp-validation-for="Name"></span>
                </div>
                <div class="col-md-6 my-2">
                    <label for="CFoundername" class="labelText">نام مدیر عامل</label>
                    <input asp-for="ManagerName" class="labelText input-text" type="text" id="CFoundername" />
                    <span class="text-danger" asp-validation-for=ManagerName></span>
                </div>
                <div class="col-md-6 my-2">
                    <label for="CMobile" class="labelText">شماره موبایل</label>
                    <input asp-for="MobileNumber"
                           class="labelText input-text"
                           oninput="this.value=this.value.replace(/(?![0-9])./gmi,'')"
                           type="text"
                           id="CMobile" />
                    <span class="text-danger" asp-validation-for=MobileNumber></span>

                </div>
                <div class="col-md-6 my-2">
                    <label for="CEmail" class="labelText">ایمیل</label>
                    <input asp-for="Email" class="labelText input-text" type="text" id="CEmail" />
                    <span class="text-danger" asp-validation-for=Email></span>
                </div>
                <div class="col-md-6 my-2">
                    <label for="CTel" class="labelText">تلفن</label>
                    <input asp-for="Tel"
                           class="labelText input-text"
                           oninput="this.value=this.value.replace(/(?![0-9])./gmi,'')"
                           type="text"
                           id="CTel" />
                </div>
                <div class="col-md-6 userEditRow">
                    <label for="CFoundername" class="labelText">وبسایت</label>
                    <input asp-for="Website" id="CWebsite" class="labelText input-text" type="text" />
                </div>
                <div class="col-md-6 my-2">
                    <label for="CAddress" class="labelText">آدرس</label>
                    <textarea asp-for="Address" id="CAddress" class="input-text"></textarea>
                    <span class="text-danger" asp-validation-for=Address></span>
                </div>
                <div class="col-md-6 my-2">
                    <label for="CBrands" class="labelText">برندهای زیر مجموعه</label>
                    <textarea asp-for="Brands" id="CBrands" class="input-text"></textarea>
                </div>
                <div class="col-md-6 my-2">
                    <label for="CCollab" class="labelText">همکاری با شرکت‌های</label>
                    <textarea asp-for="Partnership" id="CCollab" class="input-text"></textarea>
                </div>
                <div class="col-md-6 my-2">
                    <label for="CCapacity" class="labelText">ظرفیت تولید</label>
                    <textarea asp-for="Capacity" id="CCapacity" class="input-text"></textarea>
                </div>
                <div class="col-md-6 my-2">
                    <label for="CGrade" class="labelText">گرید کیفی</label>
                    <textarea asp-for="QualityGrade" id="CGrade" class="input-text"></textarea>
                </div>
                <div class="col-md-6 my-2">
                    <label for="CIso" class="labelText">استاندارد و ایزوهای اجباری و تشویقی</label>
                    <textarea asp-for="Iso" id="CIso" class="input-text"></textarea>
                </div>
                <div class="col-md-12 my-2">
                    <label for="CAbout" class="labelText">درباره شرکت</label>
                    <textarea asp-for="About" id="CAbout" class="input-text"></textarea>
                </div>
            </div>

            <div class="row mt-2 userEditRow">

                <div class="row" style="margin-top:25px;">
                    <div style="display:flex;" class="col-sm-4 col-sm-offset-5">
                        <div style="display:flex;flex-direction:column;align-items:center;">
                            <div id="previewLogo" style="margin:0;" class="ShowPic">
                                @if (Model != null && !string.IsNullOrEmpty(Model.LogoRout))
                                {
                                    <img class="prevImage" src="@Model.LogoRout" />
                                }
                            </div>
                            <div class="upBtn" style="margin-top:10px;">
                                <button type="button" class="btn-submit btnUpload" onclick="GetfileLogo()">بارگذاری لوگو</button>
                                <input asp-for="Logo" id="getfileLogo" style="display:none" class="form-control-file" type="file" accept="image/*">
                            </div>
                        </div>
                        <a href="#" id="deleteLogo"><img class="img-Icon" src="~/images/recycle.png" /></a>
                    </div>
                    <input id="IsLogoChanged" type="hidden" asp-for="IsLogoChanged" />

                </div>
@*                 <div class="col-md-6 my-2" style="margin-top:25px;">
                    <div class="col-sm-5 upBtn">
                        <button type="button" class="btn-submit btnUpload" onclick="GetfileLogo()">بارگذاری لوگو</button>
                        <input asp-for="Logo" id="getfileLogo" style="display:none" class="form-control-file" type="file" accept="image/*">
                    </div>
                    <div id="previewLogo" class="col-sm-2 ShowPic">
                        @if (Model != null && !string.IsNullOrEmpty(Model.LogoRout))
                        {
                            <img class="prevImage" src="@Model.LogoRout" />
                        }
                    </div>
                    <input id="IsLogoChanged" type="hidden" asp-for="IsLogoChanged" />

                    <div class="col-sm-2">
                        <a href="#" id="deleteLogo"><img class="img-Icon" src="~/images/recycle.png" /></a>
                    </div>

                </div>
 *@            </div>
            <div>
                <div class="row mt-2">
                    <div class="col-md-5 my-2">
                        <a style="text-align:center; width:100px" href="#" id="save" class="text-black btn-submit btn-block">
                            <span style="color:white;">ذخیره</span>
                        </a>
                    </div>
                </div>
            </div>
        </form>
        @if (Model.Id > 0)
        {
            <div>
                <div class="row mt-2">
                    <div style="margin-top:15px;" class="col-md-4 my-2">
                        <a href="@Url.Action("CompanyPictures","User",new {companyId = Model.Id})" class="btn btn-submit btn-block text-white">گالری تصاویر</a>
                    </div>
                    <div style="margin-top:15px;" class="col-md-4 my-2">
                        <a href="@Url.Action("CompanyTeaser", "User", new{companyId = Model.Id})" class="btn btn-submit btn-block text-white">تیزر تبلیغاتی</a>
                    </div>
                    <div style="margin-top:15px;" class="col-md-4 my-2">
                        <a href="@Url.Action("CompanyProductList","Product",new{companyId = Model.Id})" class="btn btn-submit btn-block text-white">محصولات</a>
                    </div>
                </div>
            </div>

        }
    </div>
</div>

@section Scripts
{
    <script>

        function GetfileLogo()
        {
            document.querySelector('#getfileLogo').click();
        }

        $("#getfileLogo").on('change',function(){
        const file = this.files[0];

            if (file)
            {
                const reader = new FileReader();
                reader.onload = function (e) {
                    // ایجاد یا جایگزینی تصویر در باکس
                    const img = $("<img>")
                    .attr("src", e.target.result)
                    .addClass("img")
                    .addClass("prevImage");

                    $("#previewLogo").empty().append(img);
                };
                reader.readAsDataURL(file);

                $("#IsLogoChanged").val(true);

            } else {
                $("#previewLogo").html("پیش‌نمایش");
            }
        });

        $("#save").click(function(event){
            event.preventDefault();
            $("#saveForm").submit();
        });


        $("#deleteLogo").click(function(event) {
            event.preventDefault();
            $("#previewLogo").html("");
            $("#getfileLogo").val("");
            $("#IsLogoChanged").val(true); // changed - deleted
        });

    </script>
}
