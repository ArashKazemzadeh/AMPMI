@model List<WebSite.EndPoint.Areas.Company.Models.CompanyPicture.CompanyPictureVM>
@{
    Layout = "~/Areas/Company/Views/Shared/_layout.cshtml";
    ViewData["SelectedCompany"] = "Gallary";
}

<div class="contaienr">
    <div class="pageName">
        <span class="textPage">گالری تصاویر</span>
    </div>
    @if (TempData["msg"] is not null)
    {
        <div class="row pageMargin">
            <p class="error-text">@TempData["msg"].ToString()</p>
        </div>
    }
    <div>
        <a href="#" id="new" class="text-black btn-submit btn-block btnSize">
            <span class="text-btn">افزودن تصویر جدید</span>
        </a>
        @* <a href="#" id="new"> <img class="img-Icon" src="~/images/addition copy.png" /> </a>
        <a hidden href="#" id="save"><img class="img-Icon" src="~/images/diskette copy.png" /></a>
        <a hidden href="#" id="cancle"><img class="img-Icon" src="~/images/cancel.png" /></a> *@
    </div>
    <div hidden id="newForm" class="pageMargin">
        <form id="saveForm" method="post" asp-area="Company" asp-controller="CompanyPicture" asp-action="NewPicture" enctype="multipart/form-data">
            <div class="form-group row">
                <div class="col-sm-2 upBtnProduct">
                    <button type="button" class="btn-submit btnUpload" onclick="getfile()">بارگذاری تصویر</button>
                    <input id="getFile" name="picture" class="form-control-file notDisplay" type="file" accept="image/*">
                </div>
                <div id="preview" class="col-sm-2 ShowPicProduct"></div>
                <div class="col-sm-8">
                    <sapn>حداکثر حجم مجاز جهت بارگذاری فایل 200 کیلو بایت است.</sapn>
                </div>
            </div>
            <div>
                <div class="row mt-2">
                    <div class="col-md-5 my-2 rubyDisplay">
                        <a href="#" id="save" class="text-black btn-submit btn-block a-btn">
                            <span class="text-btn">ذخیره</span>
                        </a>
                        <a href="#" id="cancle" class="text-black btn-submit btn-block a-btn">
                            <span class="text-btn">انصراف</span>
                        </a>
                    </div>
                </div>
            </div>
        </form>
    </div>
    <div>
        <table id="myTable" class="display tbStyle">
            <thead>
                <tr>
                    <th>ردیف</th>
                    <th>تصویر بارگذاری شده</th>
                    <th>حذف</th>
                </tr>
            </thead>
            <tbody>
                @{
                    int rowNum = 1;
                    foreach(var item in Model){
                        <tr>
                            <td class="td-Icon">@(rowNum++)</td>
                            <td><img class="img img-fluid img-Icon" src="@item.PictureFileName"/></td>
                            <td class="td-Icon"><a href="@Url.Action("Delete","CompanyPicture",new{area="Company",id=item.Id})"><img class="img-Icon" src="~/images/recycle.png" /></a></td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>
</div>
@section Scripts
{
    <script>
          document.querySelector('#myTable')
            .setAttribute('dir', 'rtl'); // Demo only

        // new DataTable('#myTable');
            $('#myTable').DataTable({
                language: {
                    "emptyTable": "هیچ داده‌ای در جدول وجود ندارد",
                    "info": "نمایش _START_ تا _END_ از _TOTAL_ رکورد",
                    "infoEmpty": "نمایش 0 تا 0 از 0 رکورد",
                    "infoFiltered": "(فیلتر شده از _MAX_ رکورد)",
                    "lengthMenu": "نمایش _MENU_ رکورد در هر صفحه",
                    "loadingRecords": "در حال بارگذاری...",
                    "processing": "در حال پردازش...",
                    "search": "جستجو:",
                    "zeroRecords": "رکوردی با این مشخصات پیدا نشد",
                    "paginate": {
                        "first": "اولین",
                        "last": "آخرین",
                        "next": "بعدی",
                        "previous": "قبلی"
                    },
                    "aria": {
                        "sortAscending": ": فعال‌سازی مرتب‌سازی صعودی",
                        "sortDescending": ": فعال‌سازی مرتب‌سازی نزولی"
                    }
                }
            });

        $("#new").click(function(){
            $("#newForm").show();
            $("#save").show();
            $("#cancle").show();
            $(this).hide();
        });

        function HideForm()
        {
            $("#newForm").hide();
        }

        $("#save").click(function(){
            const file = $("#getFile")[0].files[0];
            if (!file) {
                alert("لطفاً یک فایل انتخاب کنید.");
                return;
            }
            $("#saveForm").submit();
            HideForm();
        });

        $("#cancle").click(function(){
            HideForm();
            $("#save").hide();
            $("#cancle").hide();
            $("#new").show();
        });

         $("#edit").click(function(){
            $("#newForm").show();
            $("#save").show();
        });

        function getfile () {
            document.querySelector('#getFile').click();
        }

        $("#getFile").on('change',function(){
            const file = this.files[0];

            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    // ایجاد یا جایگزینی تصویر در باکس
                    const img = $("<img>")
                    .attr("src", e.target.result)
                    .addClass("img")
                    .addClass("prevImage");

                    $("#preview").empty().append(img);
                };
                reader.readAsDataURL(file);
            } else {
                $("#preview").html("پیش‌نمایش");
            }
        });

    </script>


}